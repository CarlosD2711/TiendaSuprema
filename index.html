# Generate a new version of the enhanced HTML that forces product headings (titles)
# to peripheral-related names based on detected category. Save to /mnt/data/index_enhanced_perifericos.html

html = r"""<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tienda Online ‚Äî Perif√©ricos</title>

  <!-- Bootstrap local -->
  <link rel="stylesheet" href="bootstrap-5.3.7-dist/css/bootstrap.min.css">

  <style>
    :root{
      --bg:#1e1e2f;
      --bg-2:#2a2a40;
      --ink:#ffffff;
      --muted:#c9c9dc;
      --brand:#a50044;
      --brand-2:#6a0033;
      --accent:#004d98;
      --card:#2a2a40;
      --border:#3a3a5a;
      --good:#19c37d;
      --bad:#ef4444;
    }
    html,body{height:100%}
    body { background-color: var(--bg); color: var(--ink); }
    .toolbar{position:sticky;top:0;z-index:1030;background:linear-gradient(180deg,var(--bg) 70%,rgba(0,0,0,0));padding:12px 0 8px;border-bottom:1px solid rgba(255,255,255,.06)}
    .form-control, .form-select{background-color:#1f1f33;border-color:var(--border);color:var(--ink)}
    .form-control::placeholder{color:#9aa}
    .input-group-text{background:#1f1f33;color:var(--muted);border-color:var(--border)}
    .btn-primary { background-color: var(--brand); border-color: var(--brand); }
    .btn-primary:hover { background-color: var(--brand-2); border-color: var(--brand-2); }
    .btn-outline-light{border-color:#6060a0;color:#eaeafa}
    .btn-outline-light:hover{background:#3b3b5f;color:#fff}

    .card { background-color: var(--card); color: #fff; border: 1px solid rgba(255,255,255,.04); }
    .card-body { display: flex; flex-direction: column; }
    .card-img-top { height: 220px; object-fit: cover; background:#131323 }
    .price{font-size:1.05rem}
    .price del{opacity:.6}
    .badge-offer{background:var(--bad)}
    .heart{cursor:pointer;font-size:1.1rem; user-select:none}
    .heart.active{color:#ff6b9e; text-shadow:0 0 10px rgba(255,107,158,.4)}

    .category-title { background-color: var(--accent); padding: 10px; color: #fff; font-weight: bold; border-radius: 5px; }
    .list-group { border-radius: 5px; overflow: hidden; }
    .list-group-item {
      background-color: var(--card); color: #fff; border-color: var(--border);
      padding: 12px 15px; transition: all .2s ease;
    }
    .list-group-item:hover {
      background-color: var(--accent); color: #fff; cursor: pointer;
      transform: translateX(5px); box-shadow: 0 4px 8px rgba(0,0,0,.2);
    }
    .list-group-item.active { background-color: var(--brand); border-color: var(--brand); font-weight: 600; }

    .cart-icon { position: fixed; top: 16px; right: 24px; z-index: 1050; }

    footer { text-align: center; padding: 18px; margin-top: 40px; background-color: #1c1c2b; border-top:1px solid rgba(255,255,255,.06) }

    .skeleton{
      background:linear-gradient(90deg,#2a2a40 25%,#33334a 37%,#2a2a40 63%);
      background-size:400% 100%;
      animation:shimmer 1.2s infinite;
      border-radius:.5rem
    }
    @keyframes shimmer{0%{background-position:100% 0}100%{background-position:-100% 0}}

    .truncate-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  </style>
</head>
<body>

  <div class="cart-icon">
    <button class="btn btn-outline-light position-relative" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart" aria-controls="offcanvasCart">
      üõí
      <span id="contadorCarrito"
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
    </button>
  </div>

  <div class="container toolbar">
    <div class="row g-2 align-items-center">
      <div class="col-12 col-lg-4">
        <div class="input-group">
          <span class="input-group-text">Buscar</span>
          <input id="inputSearch" type="search" class="form-control" placeholder="Nombre o descripci√≥n...">
        </div>
      </div>
      <div class="col-6 col-lg-2">
        <select id="selectSort" class="form-select" title="Ordenar">
          <option value="relevancia">Orden: Relevancia</option>
          <option value="precio-asc">Precio: menor a mayor</option>
          <option value="precio-desc">Precio: mayor a menor</option>
          <option value="nombre-asc">Nombre: A ‚Üí Z</option>
          <option value="nombre-desc">Nombre: Z ‚Üí A</option>
          <option value="oferta">Solo en oferta</option>
        </select>
      </div>
      <div class="col-6 col-lg-2">
        <div class="input-group">
          <span class="input-group-text">Q</span>
          <input id="minPrice" type="number" min="0" step="0.01" class="form-control" placeholder="M√≠n">
        </div>
      </div>
      <div class="col-6 col-lg-2">
        <div class="input-group">
          <span class="input-group-text">Q</span>
          <input id="maxPrice" type="number" min="0" step="0.01" class="form-control" placeholder="M√°x">
        </div>
      </div>
      <div class="col-6 col-lg-2 d-grid d-lg-block">
        <button id="btnLimpiar" class="btn btn-outline-light w-100">Limpiar filtros</button>
      </div>
    </div>
  </div>

  <div class="container mt-3">
    <div class="row">
      <div class="col-lg-3 mb-3">
        <div class="category-title d-flex justify-content-between align-items-center">
          <span>Categor√≠as</span>
          <span class="badge bg-light text-dark" id="badgeCount">0</span>
        </div>
        <ul class="list-group mt-2" id="listaCategorias"></ul>
        <div class="mt-3 d-grid">
          <button id="btnFavoritos" class="btn btn-outline-light">‚ù§ Ver favoritos</button>
        </div>
      </div>

      <div class="col-lg-9">
        <div class="row" id="contenedorProductos"></div>
        <div class="d-flex justify-content-between align-items-center my-3" id="paginacion">
          <div class="small text-muted" id="pageInfo"></div>
          <div class="btn-group">
            <button class="btn btn-outline-light" id="prevPage">&laquo; Anterior</button>
            <button class="btn btn-outline-light" id="nextPage">Siguiente &raquo;</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Dise√±ado por Carlos Arriola - 1850-22-5962
  </footer>

  <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasCart" aria-labelledby="offcanvasCartLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasCartLabel">Tu carrito</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <div id="cartItems" class="flex-grow-1"></div>
      <div class="border-top pt-3">
        <div class="d-flex justify-content-between">
          <strong>Subtotal</strong>
          <strong id="cartSubtotal">Q0.00</strong>
        </div>
        <div class="d-grid mt-3">
          <button class="btn btn-primary" id="btnCheckout">Finalizar compra</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalView" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content text-bg-dark">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Producto</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <img id="modalImg" class="img-fluid rounded" alt="Imagen producto">
            </div>
            <div class="col-md-6">
              <p id="modalDesc" class="mb-2"></p>
              <div class="h5 mb-3" id="modalPrice"></div>
              <button class="btn btn-primary" id="modalAdd">Agregar al carrito</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="bootstrap-5.3.7-dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const API_URL = "https://backcvbgtmdesa.azurewebsites.net/api/productos";

    const contenedor = document.getElementById("contenedorProductos");
    const ulCategorias = document.getElementById("listaCategorias");
    const badgeCarrito = document.getElementById("contadorCarrito");
    const badgeCount = document.getElementById("badgeCount");

    const inputSearch = document.getElementById("inputSearch");
    const selectSort = document.getElementById("selectSort");
    const minPrice = document.getElementById("minPrice");
    const maxPrice = document.getElementById("maxPrice");
    const btnLimpiar = document.getElementById("btnLimpiar");
    const btnFavoritos = document.getElementById("btnFavoritos");

    const pageInfo = document.getElementById("pageInfo");
    const prevPageBtn = document.getElementById("prevPage");
    const nextPageBtn = document.getElementById("nextPage");
    let page = 1;
    const PAGE_SIZE = 9;

    const cartItemsDiv = document.getElementById("cartItems");
    const cartSubtotal = document.getElementById("cartSubtotal");
    const btnCheckout = document.getElementById("btnCheckout");

    const modalEl = document.getElementById('modalView');
    const modal = new bootstrap.Modal(modalEl);
    const modalTitle = document.getElementById('modalTitle');
    const modalImg = document.getElementById('modalImg');
    const modalDesc = document.getElementById('modalDesc');
    const modalPrice = document.getElementById('modalPrice');
    const modalAdd = document.getElementById('modalAdd');

    let productosOriginales = [];
    let filtradosActuales = [];
    let categoriaActiva = "Todos";
    let carrito = JSON.parse(localStorage.getItem("carrito") || "[]");
    let favoritos = JSON.parse(localStorage.getItem("favoritos") || "[]");
    actualizarContadorCarrito();

    const posiblesCamposCategoria = ["Categoria", "Categor√≠a", "category", "Category", "Tipo", "TipoCategoria"];

    const Q = new Intl.NumberFormat('es-GT',{style:'currency',currency:'GTQ'});

    const CATE_ICONS = [
      ['teclado','‚å®Ô∏è Teclado mec√°nico'],
      ['keyboard','‚å®Ô∏è Teclado mec√°nico'],
      ['mouse','üñ±Ô∏è Mouse gamer'],
      ['rat√≥n','üñ±Ô∏è Mouse gamer'],
      ['auricular','üéß Auriculares'],
      ['headset','üéß Headset gaming'],
      ['aud√≠fono','üéß Auriculares'],
      ['micr√≥fono','üéôÔ∏è Micr√≥fono USB'],
      ['microfono','üéôÔ∏è Micr√≥fono USB'],
      ['webcam','üì∑ C√°mara web HD'],
      ['c√°mara','üì∑ C√°mara web HD'],
      ['camara','üì∑ C√°mara web HD'],
      ['monitor','üñ•Ô∏è Monitor gaming'],
      ['hub','üîå Hub USB 3.0'],
      ['usb','üîå Hub USB 3.0'],
      ['alfombrilla','üßº Alfombrilla RGB'],
      ['mousepad','üßº Alfombrilla RGB'],
      ['control','üéÆ Control inal√°mbrico'],
      ['gamepad','üéÆ Gamepad'],
      ['parlante','üîä Parlantes est√©reo'],
      ['bocina','üîä Parlantes est√©reo'],
      ['silla','üí∫ Silla gamer'],
      ['dock','üß© Dock USB-C'],
      ['router','üì∂ Router Wi‚ÄëFi'],
    ];

    function peripheralHeadingByCategory(cat, fallback='üì¶ Accesorio gaming'){
      if(!cat) return fallback;
      const lc = String(cat).toLowerCase();
      for(const [key, label] of CATE_ICONS){
        if(lc.includes(key)) return label;
      }
      return fallback;
    }

    function fallbackImg(ev){
      ev.target.src = 'data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><rect width="100%" height="100%" fill="%23131323"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23999" font-family="Segoe UI" font-size="28">Imagen no disponible</text></svg>`);
    }

    function obtenerCategoriaDeProducto(p) {
      for (const key of posiblesCamposCategoria) {
        if (p[key] != null && String(p[key]).trim() !== "") return String(p[key]).trim();
      }
      return "Perif√©rico";
    }

    function mostrarSkeletons(n=9){
      contenedor.innerHTML = "";
      for(let i=0;i<n;i++){
        const col = document.createElement("div");
        col.className = "col-sm-12 col-md-4 mb-4";
        col.innerHTML = `
          <div class="card h-100">
            <div class="card-img-top skeleton" style="height:220px;"></div>
            <div class="card-body">
              <div class="skeleton" style="height:20px;width:70%;margin-bottom:10px"></div>
              <div class="skeleton" style="height:14px;width:100%;margin-bottom:6px"></div>
              <div class="skeleton" style="height:14px;width:90%;margin-bottom:6px"></div>
              <div class="skeleton" style="height:24px;width:40%;margin:14px 0"></div>
              <div class="skeleton" style="height:38px;width:100%"></div>
            </div>
          </div>`;
        contenedor.appendChild(col);
      }
    }

    function renderProductos(productos) {
      const total = productos.length;
      const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      if(page > totalPages) page = totalPages;
      const start = (page-1)*PAGE_SIZE;
      const end = start + PAGE_SIZE;
      const pageItems = productos.slice(start,end);

      contenedor.innerHTML = "";
      badgeCount.textContent = String(total);

      if (!pageItems.length) {
        contenedor.innerHTML = `
          <div class="col-12">
            <div class="alert alert-warning">No hay productos con los criterios actuales.</div>
          </div>`;
        pageInfo.textContent = "0 de 0";
        return;
      }

      pageInfo.textContent = `P√°gina ${page} de ${totalPages}`;
      prevPageBtn.disabled = page <= 1;
      nextPageBtn.disabled = page >= totalPages;

      pageItems.forEach(producto => {
        const enOferta = (producto.EnOferta === true || producto.enOferta === true) && (producto.PrecioOferta ?? producto.precioOferta) != null;
        const precioBase = Number(producto.Precio ?? producto.precio ?? 0);
        const precioOferta = Number(producto.PrecioOferta ?? producto.precioOferta ?? NaN);

        const precioHTML = enOferta && !isNaN(precioOferta)
          ? `<span class="text-danger fw-bold">${Q.format(precioOferta)}</span> <del class="ms-2">${Q.format(precioBase)}</del>`
          : `<span class="fw-bold">${Q.format(precioBase)}</span>`;

        const col = document.createElement("div");
        col.className = "col-sm-12 col-md-4 mb-4";

        const favActive = favoritos.includes(producto.Id ?? producto.id);
        const cat = obtenerCategoriaDeProducto(producto);
        const tituloPeriferico = peripheralHeadingByCategory(cat);

        col.innerHTML = `
          <div class="card h-100 d-flex flex-column">
            <div class="position-relative">
              <img src="${producto.Imagen ?? producto.imagen}" class="card-img-top img-fluid" alt="${tituloPeriferico}" onerror="(${fallbackImg.toString()})(event)">
              ${enOferta ? '<span class="badge badge-offer position-absolute top-0 start-0 m-2">Oferta</span>' : ''}
              <span class="position-absolute top-0 end-0 m-2 heart ${favActive ? 'active':''}" title="Agregar a favoritos">‚ù§</span>
            </div>
            <div class="card-body">
              <h5 class="card-title truncate-2">${tituloPeriferico}</h5>
              <p class="card-text truncate-2">${producto.Descripcion ?? producto.descripcion ?? ''}</p>
              <p class="mb-2 price">${precioHTML}</p>
              <div class="d-flex gap-2 mt-auto">
                <button class="btn btn-outline-light w-50 btn-ver">Vista r√°pida</button>
                <button class="btn btn-primary w-50 btn-add">Agregar</button>
              </div>
            </div>
          </div>
        `;

        col.querySelector(".btn-add").addEventListener("click", () => addToCart(producto, 1));
        col.querySelector(".btn-ver").addEventListener("click", () => openQuickView(producto, tituloPeriferico));
        col.querySelector(".heart").addEventListener("click", (e) => toggleFavorito(producto, e.target));

        contenedor.appendChild(col);
      });
    }

    function construirCategorias(productos) {
      ulCategorias.innerHTML = "";
      const categoriasOrden = ["Todos","‚ù§ Favoritos"];
      const setCategorias = new Set();
      productos.forEach(p => setCategorias.add(obtenerCategoriaDeProducto(p)));

      categoriasOrden.push(...[...setCategorias].sort((a,b)=>a.localeCompare(b,'es')));

      categoriasOrden.forEach((cat, idx) => {
        const li = document.createElement("li");
        li.className = "list-group-item" + (idx===0 ? " active": "");
        li.textContent = cat;
        li.addEventListener("click", () => setCategoriaActiva(cat));
        ulCategorias.appendChild(li);
      });
    }

    function setCategoriaActiva(cat) {
      categoriaActiva = cat;
      page = 1;
      Array.from(ulCategorias.children).forEach(li => {
        li.classList.toggle("active", li.textContent.trim() === categoriaActiva);
      });
      aplicarFiltrosYRender();
    }

    function aplicarFiltrosYRender(){
      const q = inputSearch.value.trim().toLowerCase();
      const min = parseFloat(minPrice.value);
      const max = parseFloat(maxPrice.value);

      let base = [...productosOriginales];

      if(categoriaActiva === "‚ù§ Favoritos"){
        base = base.filter(p => favoritos.includes(p.Id ?? p.id));
      }else if(categoriaActiva !== "Todos"){
        base = base.filter(p => obtenerCategoriaDeProducto(p) === categoriaActiva);
      }

      if(q){
        base = base.filter(p => {
          const nombre = String(p.Nombre ?? p.nombre ?? "").toLowerCase();
          const desc = String(p.Descripcion ?? p.descripcion ?? "").toLowerCase();
          const cat = String(obtenerCategoriaDeProducto(p)).toLowerCase();
          return nombre.includes(q) || desc.includes(q) || cat.includes(q);
        });
      }

      base = base.filter(p => {
        const precio = Number(p.PrecioOferta ?? p.precioOferta ?? p.Precio ?? p.precio ?? 0);
        if(!isNaN(min) && precio < min) return false;
        if(!isNaN(max) && precio > max) return false;
        return true;
      });

      switch(selectSort.value){
        case "precio-asc":
          base.sort((a,b)=>(Number(a.Precio ?? a.precio ?? 0) - Number(b.Precio ?? b.precio ?? 0)));
          break;
        case "precio-desc":
          base.sort((a,b)=>(Number(b.Precio ?? b.precio ?? 0) - Number(a.Precio ?? a.precio ?? 0)));
          break;
        case "nombre-asc":
          base.sort((a,b)=>String(a.Nombre ?? a.nombre ?? '').localeCompare(String(b.Nombre ?? b.nombre ?? ''),'es'));
          break;
        case "nombre-desc":
          base.sort((a,b)=>String(b.Nombre ?? b.nombre ?? '').localeCompare(String(a.Nombre ?? a.nombre ?? ''),'es'));
          break;
        case "oferta":
          base = base.filter(p => (p.EnOferta === true || p.enOferta === true) && (p.PrecioOferta ?? p.precioOferta));
          break;
        default: break;
      }

      filtradosActuales = base;
      renderProductos(filtradosActuales);
    }

    function addToCart(producto, qty=1){
      const id = producto.Id ?? producto.id;
      const existing = carrito.find(i => i.id === id);
      const precio = Number(producto.PrecioOferta ?? producto.precioOferta ?? producto.Precio ?? producto.precio ?? 0);
      const itemBase = {
        id,
        nombre: peripheralHeadingByCategory(obtenerCategoriaDeProducto(producto)),
        precio,
        img: producto.Imagen ?? producto.imagen,
      };
      if(existing){
        existing.qty += qty;
      }else{
        carrito.push({...itemBase, qty});
      }
      persistCart();
      toast('Agregado al carrito');
      actualizarContadorCarrito();
      renderCart();
    }

    function removeFromCart(id){
      carrito = carrito.filter(i => i.id !== id);
      persistCart();
      actualizarContadorCarrito();
      renderCart();
    }

    function updateQty(id, qty){
      const item = carrito.find(i => i.id === id);
      if(!item) return;
      item.qty = Math.max(1, qty);
      persistCart();
      actualizarContadorCarrito();
      renderCart();
    }

    function renderCart(){
      if(!cartItemsDiv) return;
      cartItemsDiv.innerHTML = "";
      if(carrito.length === 0){
        cartItemsDiv.innerHTML = '<div class="text-center text-muted">Tu carrito est√° vac√≠o.</div>';
        cartSubtotal.textContent = Q.format(0);
        return;
      }
      let subtotal = 0;
      carrito.forEach(it => {
        const total = it.precio * it.qty;
        subtotal += total;
        const row = document.createElement('div');
        row.className = 'd-flex align-items-center gap-2 border-bottom py-2';
        row.innerHTML = `
          <img src="${it.img ?? ''}" onerror="(${fallbackImg.toString()})(event)" style="width:56px;height:56px;object-fit:cover" class="rounded">
          <div class="flex-grow-1">
            <div class="fw-semibold">${it.nombre}</div>
            <div class="small text-muted">${Q.format(it.precio)} x
              <input type="number" min="1" value="${it.qty}" class="form-control d-inline-block ms-1" style="width:80px;height:28px;padding:0 6px" />
            </div>
          </div>
          <div class="text-end">
            <div class="fw-semibold">${Q.format(total)}</div>
            <button class="btn btn-sm btn-outline-light mt-1">Eliminar</button>
          </div>
        `;
        row.querySelector('input').addEventListener('change', (e)=>{
          const v = parseInt(e.target.value || '1',10);
          updateQty(it.id, isNaN(v)?1:v);
        });
        row.querySelector('button').addEventListener('click', ()=> removeFromCart(it.id));
        cartItemsDiv.appendChild(row);
      });
      cartSubtotal.textContent = Q.format(subtotal);
    }

    function persistCart(){
      localStorage.setItem("carrito", JSON.stringify(carrito));
    }

    function actualizarContadorCarrito(){
      const count = carrito.reduce((acc,i)=>acc+i.qty,0);
      badgeCarrito.textContent = String(count);
    }

    function toggleFavorito(producto, elHeart){
      const id = producto.Id ?? producto.id;
      const idx = favoritos.indexOf(id);
      if(idx>=0){ favoritos.splice(idx,1); elHeart.classList.remove('active'); toast('Quitado de favoritos'); }
      else{ favoritos.push(id); elHeart.classList.add('active'); toast('A√±adido a favoritos'); }
      localStorage.setItem("favoritos", JSON.stringify(favoritos));
    }

    function openQuickView(producto, tituloOverride){
      const enOferta = (producto.EnOferta === true || producto.enOferta === true) && (producto.PrecioOferta ?? producto.precioOferta) != null;
      const precioBase = Number(producto.Precio ?? producto.precio ?? 0);
      const precioOferta = Number(producto.PrecioOferta ?? producto.precioOferta ?? NaN);

      const titulo = tituloOverride || peripheralHeadingByCategory(obtenerCategoriaDeProducto(producto));

      modalTitle.textContent = titulo;
      modalImg.src = producto.Imagen ?? producto.imagen ?? '';
      modalImg.onerror = fallbackImg;
      modalDesc.textContent = producto.Descripcion ?? producto.descripcion ?? '';
      modalPrice.innerHTML = enOferta && !isNaN(precioOferta)
        ? `<span class="text-danger fw-bold">${Q.format(precioOferta)}</span> <del class="ms-2">${Q.format(precioBase)}</del>`
        : `<span class="fw-bold">${Q.format(precioBase)}</span>`;

      modalAdd.onclick = ()=> addToCart(producto,1);
      modal.show();
    }

    function toast(msg){
      const div = document.createElement('div');
      div.className = 'position-fixed bottom-0 end-0 m-3 p-3 rounded text-white';
      div.style.background = 'rgba(0,0,0,.85)';
      div.style.zIndex = '2000';
      div.textContent = msg;
      document.body.appendChild(div);
      setTimeout(()=>{div.remove()}, 1600);
    }

    function debounce(fn, ms){
      let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(this,args), ms); };
    }

    inputSearch.addEventListener('input', debounce(()=>{ page=1; aplicarFiltrosYRender(); }, 200));
    selectSort.addEventListener('change', ()=>{ page=1; aplicarFiltrosYRender(); });
    minPrice.addEventListener('change', ()=>{ page=1; aplicarFiltrosYRender(); });
    maxPrice.addEventListener('change', ()=>{ page=1; aplicarFiltrosYRender(); });
    btnLimpiar.addEventListener('click', ()=>{
      inputSearch.value = ''; selectSort.value='relevancia';
      minPrice.value=''; maxPrice.value=''; setCategoriaActiva('Todos');
    });
    btnFavoritos.addEventListener('click', ()=> setCategoriaActiva('‚ù§ Favoritos'));
    prevPageBtn.addEventListener('click', ()=>{ if(page>1){ page--; renderProductos(filtradosActuales);} });
    nextPageBtn.addEventListener('click', ()=>{ const tp = Math.ceil(filtradosActuales.length/PAGE_SIZE)||1; if(page<tp){ page++; renderProductos(filtradosActuales);} });

    async function cargarProductos() {
      mostrarSkeletons(9);
      try {
        const resp = await fetch(API_URL, {cache:"no-store"});
        if (!resp.ok) throw new Error("HTTP " + resp.status);
        const productos = await resp.json();

        productosOriginales = Array.isArray(productos) ? productos : [];
        construirCategorias(productosOriginales);
        setCategoriaActiva("Todos");
      } catch (error) {
        console.error("Error al cargar productos:", error);
        contenedor.innerHTML = `
          <div class="col-12">
            <div class="alert alert-danger d-flex justify-content-between align-items-center">
              <div>No se pudieron cargar los productos. Revisa tu conexi√≥n e int√©ntalo de nuevo.</div>
              <button id="retryBtn" class="btn btn-outline-light btn-sm">Reintentar</button>
            </div>
          </div>`;
        ulCategorias.innerHTML = `<li class="list-group-item active">Todos</li>`;
        document.getElementById('retryBtn').addEventListener('click', cargarProductos);
      }
    }

    btnCheckout.addEventListener('click', ()=>{
      if(carrito.length===0){ toast('Tu carrito est√° vac√≠o'); return; }
      toast('Simulando pago...');
      setTimeout(()=>{
        carrito = [];
        persistCart();
        actualizarContadorCarrito();
        renderCart();
        toast('¬°Compra realizada!');
      }, 700);
    });

    document.addEventListener("DOMContentLoaded", ()=>{
      cargarProductos();
      renderCart();
    });
  </script>
</body>
</html>
"""
with open('/mnt/data/index_enhanced_perifericos.html','w', encoding='utf-8') as f:
    f.write(html)

print("/mnt/data/index_enhanced_perifericos.html")

